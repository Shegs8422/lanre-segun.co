import{d as V,r as a,o as T,c as r,a as n,b as k,u as e,e as t,F as M,f as q,w as g,t as f,v as _,i as C,g as B,h as L,j as O,k as j,l as R,m as A,T as F,n as I}from"./D8TvSErv.js";import{_ as N}from"./DlAUqK2U.js";const U={class:"flex flex-col gap-6"},E={key:0},D={class:"flex flex-col gap-4"},Q={class:"text-sm text-neutral-400"},Y=["onUpdate:modelValue"],z=["disabled"],G={key:1},H={class:"flex flex-col gap-4"},J=["disabled"],K={key:2,class:"text-red-500 text-sm text-center"},W={key:3,class:"text-green-500 text-sm text-center"},X=V({__name:"PasswordRecovery",emits:["success","cancel"],setup(S,{emit:P}){const m=P,p=a([]),i=a(["","",""]),v=a(!1),c=a(""),b=a(""),s=a(""),x=a(""),l=a(!1);T(async()=>{try{const d=await $fetch("/api/security/questions");p.value=d.questions}catch{s.value="Failed to load security questions"}});const y=async()=>{l.value=!0,s.value="";try{await $fetch("/api/security/verify",{method:"POST",body:{answers:i.value}}),v.value=!0}catch(d){s.value=d.data?.message||"Incorrect answers. Please try again."}finally{l.value=!1}},$=async()=>{if(c.value!==b.value){s.value="Passwords do not match";return}if(c.value.length<8){s.value="Password must be at least 8 characters";return}l.value=!0,s.value="";try{await $fetch("/api/auth/reset-password",{method:"POST",body:{newPassword:c.value}}),x.value="Password reset successfully! Redirecting...",setTimeout(()=>{m("success")},2e3)}catch(d){s.value=d.data?.message||"Failed to reset password"}finally{l.value=!1}};return(d,u)=>(n(),r("div",U,[e(v)?(n(),r("div",G,[u[3]||(u[3]=t("h3",{class:"text-lg font-bold text-white mb-4"},"Set New Password",-1)),t("div",H,[g(t("input",{"onUpdate:modelValue":u[0]||(u[0]=o=>C(c)?c.value=o:null),type:"password",placeholder:"New password",required:"",class:"bg-black/50 border border-neutral-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[_,e(c)]]),g(t("input",{"onUpdate:modelValue":u[1]||(u[1]=o=>C(b)?b.value=o:null),type:"password",placeholder:"Confirm new password",required:"",class:"bg-black/50 border border-neutral-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[_,e(b)]]),t("button",{onClick:$,type:"button",class:"bg-white text-black font-medium py-3 rounded-lg hover:bg-neutral-200 transition-colors",disabled:e(l)},f(e(l)?"Resetting...":"Reset Password"),9,J)])])):(n(),r("div",E,[u[2]||(u[2]=t("h3",{class:"text-lg font-bold text-white mb-4"},"Answer Your Security Questions",-1)),t("div",D,[(n(!0),r(M,null,q(e(p),(o,h)=>(n(),r("div",{key:h,class:"flex flex-col gap-2"},[t("label",Q,f(o),1),g(t("input",{"onUpdate:modelValue":w=>e(i)[h]=w,type:"text",placeholder:"Your answer",required:"",class:"bg-black/50 border border-neutral-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-blue-500 transition-colors"},null,8,Y),[[_,e(i)[h]]])]))),128)),t("button",{onClick:y,type:"button",class:"bg-white text-black font-medium py-3 rounded-lg hover:bg-neutral-200 transition-colors mt-2",disabled:e(l)},f(e(l)?"Verifying...":"Verify Answers"),9,z)])])),e(s)?(n(),r("p",K,f(e(s)),1)):k("",!0),e(x)?(n(),r("p",W,f(e(x)),1)):k("",!0)]))}}),Z=Object.assign(X,{__name:"PasswordRecovery"}),ee={key:0,class:"fixed inset-0 z-100 flex items-center justify-center bg-black/80 backdrop-blur-sm"},te={class:"bg-neutral-900 border border-neutral-800 p-8 rounded-2xl w-full max-w-sm shadow-2xl relative"},se={class:"text-xl font-bold text-white mb-6"},oe=["disabled"],ae={key:1},ne={key:2,class:"text-red-500 text-sm mt-4 text-center"},re=V({__name:"LoginModal",setup(S,{expose:P}){const m=a(!1),p=a(""),i=a(""),v=a(!1),c=a(null),b=B(),s=a(!1),x=L(()=>s.value?"Password Recovery":"Restricted Access"),l=()=>{m.value=!0,s.value=!1,I(()=>{c.value?.focus()})},y=()=>{m.value=!1,p.value="",i.value="",s.value=!1},$=async()=>{v.value=!0,i.value="";try{await $fetch("/api/auth",{method:"POST",body:{password:p.value}}),y(),b.push("/cms")}catch{i.value="Incorrect password"}finally{v.value=!1}},d=()=>{y()};return P({open:l}),(u,o)=>{const h=Z;return n(),O(F,{name:"fade"},{default:j(()=>[e(m)?(n(),r("div",ee,[t("div",te,[t("button",{onClick:y,class:"absolute top-4 right-4 text-neutral-500 hover:text-white"},[...o[4]||(o[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])]),t("h2",se,f(e(x)),1),e(s)?(n(),r("div",ae,[A(h,{onSuccess:d,onCancel:o[2]||(o[2]=w=>s.value=!1)}),t("button",{onClick:o[3]||(o[3]=w=>s.value=!1),type:"button",class:"w-full text-sm text-neutral-400 hover:text-white transition-colors mt-4"}," Back to Login ")])):(n(),r("form",{key:0,onSubmit:R($,["prevent"]),class:"flex flex-col gap-4"},[g(t("input",{ref_key:"passwordInput",ref:c,"onUpdate:modelValue":o[0]||(o[0]=w=>C(p)?p.value=w:null),type:"password",placeholder:"Enter password...",autocomplete:"current-password",class:"bg-black/50 border border-neutral-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[_,e(p)]]),t("button",{type:"submit",class:"bg-white text-black font-medium py-3 rounded-lg hover:bg-neutral-200 transition-colors",disabled:e(v)},f(e(v)?"Checking...":"Enter CMS"),9,oe),t("button",{onClick:o[1]||(o[1]=R(w=>s.value=!0,["prevent"])),type:"button",class:"text-sm text-neutral-400 hover:text-white transition-colors mt-2"}," Forgot Password? ")],32)),e(i)?(n(),r("p",ne,f(e(i)),1)):k("",!0)])])):k("",!0)]),_:1})}}}),ie=Object.assign(N(re,[["__scopeId","data-v-508129e8"]]),{__name:"LoginModal"});export{ie as default};
