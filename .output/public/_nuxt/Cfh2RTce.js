import{d as q,r as o,o as V,c as i,a as l,b as g,u as t,e as s,F as M,f as T,w as x,t as v,v as h,i as C,g as B,h as F,j as L,k as O,l as S,m as j,T as A,n as I}from"./C_cv6QeR.js";import{u as N}from"./Czc6oJiQ.js";import{_ as U}from"./DlAUqK2U.js";const E={class:"flex flex-col gap-6"},D={key:0},Q={class:"flex flex-col gap-4"},Y={class:"text-sm text-neutral-400"},z=["onUpdate:modelValue"],G=["disabled"],H={key:1},J={class:"flex flex-col gap-4"},K=["disabled"],W={key:2,class:"text-red-500 text-sm text-center"},X={key:3,class:"text-green-500 text-sm text-center"},Z=q({__name:"PasswordRecovery",emits:["success","cancel"],setup($,{emit:_}){const w=_,p=o([]),c=o(["","",""]),m=o(!1),d=o(""),a=o(""),n=o(""),y=o(""),r=o(!1);V(async()=>{const f=N();try{const{data:e,error:u}=await f.from("security_questions").select("question_1, question_2, question_3").limit(1).maybeSingle();if(u)throw u;e?p.value=[e.question_1,e.question_2,e.question_3]:n.value="Security questions have not been set up yet. Please log into the CMS to configure them."}catch(e){console.error("Failed to load security questions:",e),n.value="Failed to load security questions. Please ensure you have set them up in the CMS."}});const k=async()=>{r.value=!0,n.value="";try{await $fetch("/api/security/verify",{method:"POST",body:{answers:c.value}}),m.value=!0}catch(f){n.value=f.data?.message||"Incorrect answers. Please try again."}finally{r.value=!1}},P=async()=>{if(d.value!==a.value){n.value="Passwords do not match";return}if(d.value.length<8){n.value="Password must be at least 8 characters";return}r.value=!0,n.value="";try{await $fetch("/api/auth/reset-password",{method:"POST",body:{newPassword:d.value}}),y.value="Password reset successfully! Redirecting...",setTimeout(()=>{w("success")},2e3)}catch(f){n.value=f.data?.message||"Failed to reset password"}finally{r.value=!1}};return(f,e)=>(l(),i("div",E,[t(m)?(l(),i("div",H,[e[3]||(e[3]=s("h3",{class:"text-lg font-bold text-white mb-4"},"Set New Password",-1)),s("div",J,[x(s("input",{"onUpdate:modelValue":e[0]||(e[0]=u=>C(d)?d.value=u:null),type:"password",placeholder:"New password",required:"",class:"bg-black/50 border border-neutral-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[h,t(d)]]),x(s("input",{"onUpdate:modelValue":e[1]||(e[1]=u=>C(a)?a.value=u:null),type:"password",placeholder:"Confirm new password",required:"",class:"bg-black/50 border border-neutral-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[h,t(a)]]),s("button",{onClick:P,type:"button",class:"bg-white text-black font-medium py-3 rounded-lg hover:bg-neutral-200 transition-colors",disabled:t(r)},v(t(r)?"Resetting...":"Reset Password"),9,K)])])):(l(),i("div",D,[e[2]||(e[2]=s("h3",{class:"text-lg font-bold text-white mb-4"},"Answer Your Security Questions",-1)),s("div",Q,[(l(!0),i(M,null,T(t(p),(u,b)=>(l(),i("div",{key:b,class:"flex flex-col gap-2"},[s("label",Y,v(u),1),x(s("input",{"onUpdate:modelValue":R=>t(c)[b]=R,type:"text",placeholder:"Your answer",required:"",class:"bg-black/50 border border-neutral-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-blue-500 transition-colors"},null,8,z),[[h,t(c)[b]]])]))),128)),s("button",{onClick:k,type:"button",class:"bg-white text-black font-medium py-3 rounded-lg hover:bg-neutral-200 transition-colors mt-2",disabled:t(r)},v(t(r)?"Verifying...":"Verify Answers"),9,G)])])),t(n)?(l(),i("p",W,v(t(n)),1)):g("",!0),t(y)?(l(),i("p",X,v(t(y)),1)):g("",!0)]))}}),ee=Object.assign(Z,{__name:"PasswordRecovery"}),te={key:0,class:"fixed inset-0 z-100 flex items-center justify-center bg-black/80 backdrop-blur-sm"},se={class:"bg-neutral-900 border border-neutral-800 p-8 rounded-2xl w-full max-w-sm shadow-2xl relative"},oe={class:"text-xl font-bold text-white mb-6"},ae=["disabled"],ne={key:1},re={key:2,class:"text-red-500 text-sm mt-4 text-center"},le=q({__name:"LoginModal",setup($,{expose:_}){const w=o(!1),p=o(""),c=o(""),m=o(!1),d=o(null);B();const a=o(!1),n=F(()=>a.value?"Password Recovery":"Restricted Access"),y=()=>{w.value=!0,a.value=!1,I(()=>{d.value?.focus()})},r=()=>{w.value=!1,p.value="",c.value="",a.value=!1},k=async()=>{m.value=!0,c.value="";try{await $fetch("/api/auth",{method:"POST",body:{password:p.value}}),r(),window.location.href="/cms"}catch{c.value="Incorrect password"}finally{m.value=!1}},P=()=>{r()};return _({open:y}),(f,e)=>{const u=ee;return l(),L(A,{name:"fade"},{default:O(()=>[t(w)?(l(),i("div",te,[s("div",se,[s("button",{onClick:r,class:"absolute top-4 right-4 text-neutral-500 hover:text-white"},[...e[4]||(e[4]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[s("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])]),s("h2",oe,v(t(n)),1),t(a)?(l(),i("div",ne,[j(u,{onSuccess:P,onCancel:e[2]||(e[2]=b=>a.value=!1)}),s("button",{onClick:e[3]||(e[3]=b=>a.value=!1),type:"button",class:"w-full text-sm text-neutral-400 hover:text-white transition-colors mt-4"}," Back to Login ")])):(l(),i("form",{key:0,onSubmit:S(k,["prevent"]),class:"flex flex-col gap-4"},[x(s("input",{ref_key:"passwordInput",ref:d,"onUpdate:modelValue":e[0]||(e[0]=b=>C(p)?p.value=b:null),type:"password",placeholder:"Enter password...",autocomplete:"current-password",class:"bg-black/50 border border-neutral-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-500 transition-colors"},null,512),[[h,t(p)]]),s("button",{type:"submit",class:"bg-white text-black font-medium py-3 rounded-lg hover:bg-neutral-200 transition-colors",disabled:t(m)},v(t(m)?"Checking...":"Enter CMS"),9,ae),s("button",{onClick:e[1]||(e[1]=S(b=>a.value=!0,["prevent"])),type:"button",class:"text-sm text-neutral-400 hover:text-white transition-colors mt-2"}," Forgot Password? ")],32)),t(c)?(l(),i("p",re,v(t(c)),1)):g("",!0)])])):g("",!0)]),_:1})}}}),de=Object.assign(U(le,[["__scopeId","data-v-7f89f2a9"]]),{__name:"LoginModal"});export{de as default};
